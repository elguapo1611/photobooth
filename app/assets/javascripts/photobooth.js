// Generated by CoffeeScript 1.4.0
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

this.Photobooth = (function() {

  function Photobooth() {
    this.setup = __bind(this.setup, this);

    this.startCountDown = __bind(this.startCountDown, this);

    this.takePhoto = __bind(this.takePhoto, this);

    this.setTextPosition = __bind(this.setTextPosition, this);
    this.count = 3;
    this.countdownRunning = false;
    this.setup();
  }

  Photobooth.prototype.setTextPosition = function() {
    var position;
    position = ($(window).height() / 2 - $("#coundown").height() / 2) + "px";
    console.log(position);
    return $("#countdown").css("top", position);
  };

  Photobooth.prototype.takePhoto = function() {
    return $.post($("#countdown").attr("data-url"), function(data) {
      $("#countdown-bg").hide();
      $("#countdown").hide();
      $("#countdown h1").html("");
      $("#photostream").prepend("<li>" + $("#current_photo").html() + "</li>");
      $("#current_photo").html("<a class=\"thumbnail\"><img width=\"780px\" src=\"" + data.image_url + "\"/></a>");
    });
  };

  Photobooth.prototype.startCountDown = function() {
    var _this = this;
    return setTimeout((function() {
      _this.count = _this.count - 1;
      if (_this.count >= 0) {
        $("#countdown h1").html(_this.count + 1);
        _this.startCountDown();
      } else {
        _this.countdownRunning = false;
        $("#countdown h1").html("cheese!!!");
        _this.takePhoto();
        _this.count = 3;
      }
    }), 1000);
  };

  Photobooth.prototype.setup = function() {
    var _this = this;
    return $(document).bind("keypress", function(e) {
      console.log(e.keyCode);
      if (e.keyCode === 13) {
        _this.setTextPosition();
        $("#countdown-bg").show();
        $("#countdown").show();
        _this.startCountDown();
      }
    });
  };

  return Photobooth;

})();
